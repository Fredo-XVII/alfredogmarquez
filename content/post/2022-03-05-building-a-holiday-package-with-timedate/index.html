---
title: "Building a Holiday Package with timeDate"
author: "Alfredo G Marquez"
date: "3/6/2022"
output: html_document
slug: building-a-holiday-package-with-timedate
categories:
  - R
  - Package Building
tags:
  - US Retail Holidays
  - holiday.dates
  - timeDate
  - r package
keywords:
  - R Package Holiday Dates
  
summary: Today I will discuss building custom dates with timeDate package.
draft: yes  
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="libraries" class="section level3">
<h3>Libraries</h3>
<pre><code>library(timeDate)
library(holiday.dates)</code></pre>
</div>
<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>It has been a while since my last post. You can probably imagine why with all that is going on in the world these days. Today I will talk about using the <code>timeDate</code> package to build custome dates for any project.</p>
</div>
<div id="data-problem" class="section level3">
<h3>Data Problem</h3>
<p>In my work to build time series models I need to account for the seasonality that occurs in retail. I discovered the <code>timeDate</code> package from another team at work. After playing with the functions in the package for a bit, I realized how flexible the functions in the package can be to building custom holiday dates.</p>
</div>
<div id="the-timedate-package" class="section level3">
<h3>The timeDate Package</h3>
<p>Source: <a href="https://cran.r-project.org/web/packages/timeDate/timeDate.pdf" class="uri">https://cran.r-project.org/web/packages/timeDate/timeDate.pdf</a></p>
<p>There are many useful functions in the <code>timeDate</code> package. Today, I will only focus on a couple that allowed me to create custom dates that are important to my forecasting work.</p>
<p>First, I don’t want to reproduce a holiday that already exists in the <code>timeDate</code> package. Lets check to see what holidays are available in the <code>timeDate</code> package.</p>
<pre class="r"><code>timeDate::listHolidays()</code></pre>
<pre><code>##   [1] &quot;Advent1st&quot;                &quot;Advent2nd&quot;               
##   [3] &quot;Advent3rd&quot;                &quot;Advent4th&quot;               
##   [5] &quot;AllSaints&quot;                &quot;AllSouls&quot;                
##   [7] &quot;Annunciation&quot;             &quot;Ascension&quot;               
##   [9] &quot;AshWednesday&quot;             &quot;AssumptionOfMary&quot;        
##  [11] &quot;BirthOfVirginMary&quot;        &quot;BoxingDay&quot;               
##  [13] &quot;CACanadaDay&quot;              &quot;CACivicProvincialHoliday&quot;
##  [15] &quot;CALabourDay&quot;              &quot;CaRemembranceDay&quot;        
##  [17] &quot;CAThanksgivingDay&quot;        &quot;CAVictoriaDay&quot;           
##  [19] &quot;CelebrationOfHolyCross&quot;   &quot;CHAscension&quot;             
##  [21] &quot;CHBerchtoldsDay&quot;          &quot;CHConfederationDay&quot;      
##  [23] &quot;CHKnabenschiessen&quot;        &quot;ChristmasDay&quot;            
##  [25] &quot;ChristmasEve&quot;             &quot;ChristTheKing&quot;           
##  [27] &quot;CHSechselaeuten&quot;          &quot;CorpusChristi&quot;           
##  [29] &quot;DEAscension&quot;              &quot;DEChristmasEve&quot;          
##  [31] &quot;DECorpusChristi&quot;          &quot;DEGermanUnity&quot;           
##  [33] &quot;DENewYearsEve&quot;            &quot;Easter&quot;                  
##  [35] &quot;EasterMonday&quot;             &quot;EasterSunday&quot;            
##  [37] &quot;Epiphany&quot;                 &quot;FRAllSaints&quot;             
##  [39] &quot;FRArmisticeDay&quot;           &quot;FRAscension&quot;             
##  [41] &quot;FRAssumptionVirginMary&quot;   &quot;FRBastilleDay&quot;           
##  [43] &quot;FRFetDeLaVictoire1945&quot;    &quot;GBBankHoliday&quot;           
##  [45] &quot;GBMayDay&quot;                 &quot;GBMilleniumDay&quot;          
##  [47] &quot;GBSummerBankHoliday&quot;      &quot;GoodFriday&quot;              
##  [49] &quot;ITAllSaints&quot;              &quot;ITAssumptionOfVirginMary&quot;
##  [51] &quot;ITEpiphany&quot;               &quot;ITImmaculateConception&quot;  
##  [53] &quot;ITLiberationDay&quot;          &quot;ITStAmrose&quot;              
##  [55] &quot;JPAutumnalEquinox&quot;        &quot;JPBankHolidayDec31&quot;      
##  [57] &quot;JPBankHolidayJan2&quot;        &quot;JPBankHolidayJan3&quot;       
##  [59] &quot;JPBunkaNoHi&quot;              &quot;JPChildrensDay&quot;          
##  [61] &quot;JPComingOfAgeDay&quot;         &quot;JPConstitutionDay&quot;       
##  [63] &quot;JPEmperorsBirthday&quot;       &quot;JPGantan&quot;                
##  [65] &quot;JPGreeneryDay&quot;            &quot;JPHealthandSportsDay&quot;    
##  [67] &quot;JPKeirouNOhi&quot;             &quot;JPKenkokuKinenNoHi&quot;      
##  [69] &quot;JPKenpouKinenBi&quot;          &quot;JPKinrouKanshaNoHi&quot;      
##  [71] &quot;JPKodomoNoHi&quot;             &quot;JPKokuminNoKyujitu&quot;      
##  [73] &quot;JPMarineDay&quot;              &quot;JPMidoriNoHi&quot;            
##  [75] &quot;JPNatFoundationDay&quot;       &quot;JPNationalCultureDay&quot;    
##  [77] &quot;JPNationHoliday&quot;          &quot;JPNewYearsDay&quot;           
##  [79] &quot;JPRespectForTheAgedDay&quot;   &quot;JPSeijinNoHi&quot;            
##  [81] &quot;JPShuubunNoHi&quot;            &quot;JPTaiikuNoHi&quot;            
##  [83] &quot;JPTennouTanjyouBi&quot;        &quot;JPThanksgivingDay&quot;       
##  [85] &quot;JPUmiNoHi&quot;                &quot;LaborDay&quot;                
##  [87] &quot;MassOfArchangels&quot;         &quot;NewYearsDay&quot;             
##  [89] &quot;PalmSunday&quot;               &quot;Pentecost&quot;               
##  [91] &quot;PentecostMonday&quot;          &quot;PresentationOfLord&quot;      
##  [93] &quot;Quinquagesima&quot;            &quot;RogationSunday&quot;          
##  [95] &quot;Septuagesima&quot;             &quot;SolemnityOfMary&quot;         
##  [97] &quot;TransfigurationOfLord&quot;    &quot;TrinitySunday&quot;           
##  [99] &quot;USChristmasDay&quot;           &quot;USColumbusDay&quot;           
## [101] &quot;USCPulaskisBirthday&quot;      &quot;USDecorationMemorialDay&quot; 
## [103] &quot;USElectionDay&quot;            &quot;USGoodFriday&quot;            
## [105] &quot;USInaugurationDay&quot;        &quot;USIndependenceDay&quot;       
## [107] &quot;USLaborDay&quot;               &quot;USLincolnsBirthday&quot;      
## [109] &quot;USMemorialDay&quot;            &quot;USMLKingsBirthday&quot;       
## [111] &quot;USNewYearsDay&quot;            &quot;USPresidentsDay&quot;         
## [113] &quot;USThanksgivingDay&quot;        &quot;USVeteransDay&quot;           
## [115] &quot;USWashingtonsBirthday&quot;</code></pre>
<p>From the list above we can see that the Valentine holiday is not included in the <code>timeDate</code> package. We can build a custome function by copying one of the functions from the <code>timeDate</code> package and changing it to meet our needs.</p>
<p>One type of function builds dates based on the year and the number of days from the beginning of the year. For example, if we look at how the <code>timeDate::NewYearsDay</code> function is built gives us template on how to create a holiday based on number of days in a year from the beginning of the year.</p>
<pre class="r"><code>timeDate::NewYearsDay</code></pre>
<pre><code>## function (year = getRmetricsOptions(&quot;currentYear&quot;)) 
## {
##     ans = year * 10000 + 101
##     timeDate(as.character(ans))
## }
## &lt;bytecode: 0x000000002283c6d0&gt;
## &lt;environment: namespace:timeDate&gt;</code></pre>
<p>We are going to change the 101 in the function above to 0214. I like including the <code>0</code> because it feels more like a date when you look at the function. The new USValentinesDay function is defined below.</p>
<pre class="r"><code>USValentinesDay &lt;-
  function(year = timeDate::getRmetricsOptions(&quot;currentYear&quot;)) {
    ans = year*10000 + 0214
    timeDate::timeDate(as.character(ans)) }</code></pre>
<p>The <code>year</code> argument for the function allows you to select any year to get the date for Valentines. For example, for 2022 I would expect to get 2022-02-14 for Valentines day. Lets try it with a vector of years:</p>
<pre class="r"><code>USValentinesDay(year = c(2019,2020,2021,2022))</code></pre>
<pre><code>## GMT
## [1] [2019-02-14] [2020-02-14] [2021-02-14] [2022-02-14]</code></pre>
<p>The second type of function is based on a rule that determines when the holiday will happen. Let’s look into how the US Thanksgiving Day is built within the <code>timeDate</code>:</p>
<pre class="r"><code>timeDate::USThanksgivingDay</code></pre>
<pre><code>## function (year = getRmetricsOptions(&quot;currentYear&quot;)) 
## {
##     ans = .nth.of.nday(year, 11, 4, 4)
##     timeDate(as.character(ans))
## }
## &lt;bytecode: 0x0000000022e8d4c8&gt;
## &lt;environment: namespace:timeDate&gt;</code></pre>
<p>You can see that the heart of this rule based solution is the <code>.nth.of.nday</code> function. The functions takes the following arguments: year, month, week number, day number. We can read the function arguments as: <strong>For year and November, find the 4th day of the 4th week.</strong></p>
<p>For example, Mother’s Day in the US is in May on the 2nd Sunday of the month. This is how I built a solution for Mother’s Day in the US:</p>
<pre class="r"><code>holiday.dates::USMothersDay</code></pre>
<pre><code>## function (year = timeDate::getRmetricsOptions(&quot;currentYear&quot;)) 
## {
##     ans = .nth.of.nday(year, 5, 7, 2)
##     timeDate::timeDate(as.character(ans))
## }
## &lt;bytecode: 0x00000000227bdb90&gt;
## &lt;environment: namespace:holiday.dates&gt;</code></pre>
<p>The arguments for the <code>.nth.of.nday</code> read as: <strong>For year and May, find the 7th day of the second week.</strong></p>
<p>Let’s test how it works for the years on <a href="https://en.wikipedia.org/wiki/Mother%27s_Day_(United_States)">Mother’s Day on Wikipedia</a>, 2021 to 2024. Here is a copy of the dates from the site:</p>
<pre><code>Begins  2nd Sunday of May
Date    Second Sunday in May
2021 date   May 9
2022 date   May 8
2023 date   May 14
2024 date   May 12
Frequency   Annual</code></pre>
<pre class="r"><code>holiday.dates::USMothersDay(c(2021, 2022, 2023, 2024))</code></pre>
<pre><code>## GMT
## [1] [2021-05-09] [2022-05-08] [2023-05-14] [2024-05-12]</code></pre>
<p>As you can see that these dates match.</p>
</div>
<div id="the-last-word" class="section level3">
<h3>The Last Word</h3>
<p>These 2 simple, but yet flexible functions, that allow you to customize dates for analysis or model building. In the next post I will discuss how I built a little package that allows you to find the major retail holidays in US that are not included in the <code>timeDate</code> package, that are important for what I needed in my work.</p>
</div>
